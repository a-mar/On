%----------------------------------------------------------%

%----------------------------------%
%   *VERY* CUMBERSOME PREAMBLE     %
%----------------------------------%

\documentclass[a4paper,11pt]{report}
\renewcommand*{\familydefault}{\sfdefault}
\usepackage[hoffset=0.5truein,vscale=0.8,footskip=1.75truecm]{geometry}
\usepackage[english]{babel}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%            GLOSSARY            %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[nonumberlist,nopostdot,style=super]{glossaries}
\usepackage{acronym}
\usepackage{glossary-mcols}
%firstchar uppercase, text lowercase
\let\firstchar\lowercase
\let\oldprintglossary\printglossary
\def\printglossary{\let\firstchar\uppercase\oldprintglossary}

\makeglossaries

\renewcommand{\glsnamefont}[1]{\textbf{#1}}
\setlength{\glsdescwidth}{0.8\textwidth}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%              FONT              %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[utf8]{inputenc}
\usepackage[no-math]{fontspec}
\setmainfont{Charter-Reg.otf}[
Path = fonts/,
BoldFont = Charter-Bold.otf,
ItalicFont = Charter-It.otf,
BoldItalicFont = Charter-BoldIt.otf]

%FIRA SANS http://www.carrois.com/en/fira-4-1/
\setsansfont{FiraSans-Light.otf}[
	Path=fonts/,
	Scale=MatchLowercase,
	BoldFont = FiraSans-Regular.otf,
	ItalicFont = FiraSans-LightItalic.otf,
	BoldItalicFont = FiraSans-Italic.otf]
\newfontfamily\ExtraLig{FiraSans-ExtraLight.otf}[
	Path=fonts/,
	Scale=MatchLowercase,
	ItalicFont = FiraSans-ExtraLightItalic.otf]
\newfontfamily\UltraLig{FiraSans-UltraLight.otf}[
	Path=fonts/,
	Scale=MatchLowercase,
	ItalicFont = FiraSans-UltraLightItalic.otf]
\newfontfamily\Medium{FiraSans-Medium.otf}[
	Path=fonts/,
	Scale=MatchLowercase,
	ItalicFont = FiraSans-MediumItalic.otf]
\newfontfamily\Book{FiraSans-Book.otf}[
	Path=fonts/,
	Scale=MatchLowercase,
	BoldFont = FiraSans-SemiBold.otf,
	ItalicFont = FiraSans-BookItalic.otf,
	BoldItalicFont = FiraSans-SemiBoldItalic.otf]
\newfontfamily\Charter{Charter-Reg.otf}[
	Path=fonts/,
	Scale=MatchLowercase,
	Mapping=tex-text,
	Numbers={Proportional},
	BoldFont=Charter-Bold.otf,
	ItalicFont=Charter-It.otf,
	BoldItalicFont=Charter-BoldIt.otf]
\newfontfamily\Mono{FiraMono-Regular.otf}[Path=fonts/, Scale=MatchLowercase]
\defaultfontfeatures{Mapping=tex-text, Scale = MatchLowercase}


%BITSTREAM CHARTER
\newcommand*{\mifont}{\usefont{T1}{bch}{m}{n}\selectfont}{\par}
\newcommand*{\myfont}{\fontfamily{cmr}\selectfont}

\usepackage{fourier-orns}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%              URL               %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[hyphens]{url}

\makeatletter
\def\url@foostyle{%
  \@ifundefined{selectfont}{\def\UrlFont{\sf}}{\def\UrlFont{\sloppy\Mono}}}
\makeatother


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%             OTHERS             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[table,xcdraw,usenames,dvipsnames]{xcolor}
\usepackage{xfrac}
\usepackage{amsmath}
\usepackage{graphicx}
\graphicspath{{imagen/}}
\usepackage[colorinlistoftodos]{todonotes}
\usepackage[UKenglish]{isodate}
\cleanlookdateon
\usepackage{abbrevs}
\usepackage{relsize}
%COLOUR SWATCH
\makeatletter
\def\testclr#1#{\@testclr{#1}}
\def\@testclr#1#2{{\fboxsep\z@\fbox{\colorbox#1{#2}{\phantom{XX}}}}}
\newcommand*\Color[1]{\textsl{#1}}
\makeatother


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%              TOC               %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{titlesec}
\usepackage{titletoc}
\usepackage{appendix}
\usepackage[titles]{tocloft}

\renewcommand{\cftfigfont}{\usefont{T1}{bch}{m}{n}\selectfont}
\renewcommand{\cfttabfont}{\usefont{T1}{bch}{m}{n}\selectfont}

\titlecontents{chapter} 
[2.3em]                 % adjust left margin
{\bfseries}             % font formatting
{\contentslabel{2.3em}} % section label and offset
{\hspace*{-2.3em}}
{\titlerule*[1pc]{.}\contentspage}

\makeatletter
\titlecontents{chapter}%
 [0em]% 
 {\addvspace{2em}}%
 {\bfseries\@chapapp\ \thecontentslabel\quad}% 
 {\hspace{-0em}}% 
 {\hfill\contentspage}% 
 [\addvspace{0pt}]% 

\g@addto@macro\appendices{%
  \addtocontents{toc}{\protect\renewcommand{\protect\@chapapp}{\appendixname}}%
}
\makeatother

\renewcommand{\cftsecfont} % section titles
             {\usefont{T1}{bch}{m}{n}\selectfont}
\renewcommand{\cftsubsecfont} % subsection titles
             {\usefont{T1}{bch}{m}{n}\selectfont} 
\renewcommand{\cftchappagefont} % chapter page numbers
             {\usefont{T1}{bch}{m}{n}\selectfont}
\renewcommand{\cftsecpagefont} % section page numbers
             {\cftsecfont} 
\renewcommand{\cftsubsecpagefont} % subsection page numbers
             {\cftsubsecfont}
\renewcommand{\cftfigpagefont} % ListofFigures page numbers
             {\cftsecfont}
\renewcommand{\cfttabpagefont} % ListofTables page numbers
             {\cftsecfont}
          

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%     CHAPTER HEADER FORMATS     %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%FOR SUB/SECTION NUMBERS OUTSIDE MARGIN, TITLES FLUSH LEFT
%\newlength\mylen
%\setlength\mylen{\dimexpr+\hoffset\relax}

\titleformat{\chapter}[display]
	{\Medium\Huge\filcenter}
	{\chaptertitlename\ \thechapter}{-11pt}{\Huge}
\titleformat{\section}[block]
	{\Medium\huge}
	%{\llap{\hspace*{-\mylen}\thesection\hfill}}{0em}{}	%Section numbers OUTSIDE OF MARGIN, section title FLUSH LEFT
	{\thesection}{0.9em}{}
\titleformat{\subsection}[block]
	{\Medium\LARGE}
	%{\llap{\hspace*{-\mylen}\thesubsection\hfill}}{0em}{}	%SubSect numbers OUTSIDE OF MARGIN, SubSect title FLUSH LEFT
	{\thesubsection}{0.9em}{}

\titlespacing*{\chapter}{0pt}{-44pt}{18pt}
\titlespacing*{\section}{0pt}{13pt}{9pt}
\titlespacing*{\subsection}{0pt}{10pt}{9pt}
\titleformat{\subparagraph}
	{\Medium\Large}
	{\thesubparagraph}{1em}{}
\titlespacing*{\subparagraph}{\parindent}{2.3ex plus 1ex minus .2ex}{.75ex plus .1ex}
\usepackage{blindtext}
\setlength{\textfloatsep}{21pt plus 2.0pt minus 4.0pt}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%             SPACING            %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{setspace}
\usepackage{leading}
\leading{13.8pt}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%    BACK/FRONT MATTER HEADERS   %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{fancyhdr}
\renewcommand{\headrulewidth}{0pt}
\addto\captionsenglish{\renewcommand{\contentsname}{\centering\vspace*{10pt}Table of Contents\vspace{5pt}}}
\addto\captionsenglish{\renewcommand{\listfigurename}{\centering\vspace*{10pt}List of Figures\vspace{5pt}}}
\addto\captionsenglish{\renewcommand{\listtablename}{\centering\vspace*{10pt}List of Tables\vspace{5pt}}}
\newcommand*{\glossyname}{Abbreviations}
\addto\captionsenglish{\renewcommand{\glossyname}{\Medium\Huge\centering\vspace*{11pt}Abbreviations\vspace{5pt}}}
\newcommand*{\ackname}{Acknowledgements}
\addto\captionsenglish{\renewcommand{\ackname}{\Medium\Huge\centering\vspace*{-31pt}Acknowledgements\vspace{3pt}}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%            PLACEINS            %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{placeins}  %cousin of casein :)
\makeatletter
\AtBeginDocument{%
  \expandafter\renewcommand\expandafter\subsection\expandafter
    {\expandafter\@fb@secFB\subsection}%
  \newcommand\@fb@secFB{\FloatBarrier
    \gdef\@fb@afterHHook{\@fb@topbarrier \gdef\@fb@afterHHook{}}}%
  \g@addto@macro\@afterheading{\@fb@afterHHook}%
  \gdef\@fb@afterHHook{}%
}
\makeatother


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%         MARGINS + LOGOS        %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\usepackage{showframe} %MARGIN FOR DRAFT
\usepackage{dtklogos}
\usepackage{cclicenses}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%          SUB/CAPTIONS          %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[margin=1cm]{caption}
\DeclareCaptionLabelFormat{mycaption}{%
  \bothIfFirst{\Medium{#1}}{~}\Medium{#2}}
\captionsetup{labelsep=quad,labelformat=mycaption,justification=centering}
\usepackage{subcaption}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%            PGFPLOTS            %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{chemfig}
\usepackage{pgfplots}
%\pgfplotsset{width=7cm,compat=1.8}
\usepgfplotslibrary{patchplots}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%             BIBLIO             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{apacite}
\usepackage[longnamesfirst]{natbib}
\renewcommand{\bibsection}{\centering\vspace{28pt}\vspace{-24pt}}
\usepackage[version=4]{mhchem}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%         CUSTOM LEGEND          %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newenvironment{customlegend}[1][]{%
    \begingroup
    % inits/clears the lists (which might be populated from previous
    % axes):
    \csname pgfplots@init@cleared@structures\endcsname
    \pgfplotsset{#1}%
}{%
    % draws the legend:
    \csname pgfplots@createlegend\endcsname
    \endgroup
}%

% makes \addlegendimage available (typically only available within an
% axis environment):
\def\addlegendimage{\csname pgfplots@addlegendimage\endcsname}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%            TABLEAUX            %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{float}
\floatstyle{plaintop}
\restylefloat{table}

\usepackage{tabu}
\usepackage{tabularx}
\usepackage{hhline}
\usepackage{array}
\newcolumntype{R}{>{\raggedleft\arraybackslash}m{0.95cm}}
\newcolumntype{D}{>{\singlespacing\arraybackslash}p{5.6cm}}
\newcolumntype{M}{>{\singlespacing\arraybackslash}p{4cm}}
\usepackage{pgfgantt}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%      PAR SPACE + TABLEAU       %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{parskip}
\setlength{\parskip}{\baselineskip}

\usepackage{booktabs}
\usepackage[flushleft]{threeparttable}
\usepackage{threeparttablex}
\usepackage{multirow}

\usepackage{afterpage}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%          HYPERDOODLES          %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[
	pdftitle={INSERT TITLE HERE},
        pdfsubject={Economics},
        linktoc=all, breaklinks=true]{hyperref}
\hypersetup{
	colorlinks,
	linkcolor={bloo},		%CHANGE TO BLACK WHEN DONE
	citecolor={cwcGreen3},	%CHANGE TO BLACK WHEN DONE
	urlcolor={redd!60!cwcSalmon85!90!plumb},
	pdfauthor={INSERT NAME HERE},
	pdfkeywords={{INSERT}, {KEY}, {WORDS}}}
\PassOptionsToPackage{hyphens}{url}\usepackage{hyperref}
\usepackage{bookmark}

%hyperlinked images + fontspec
\newsavebox{\ximagebox}
\newlength{\ximageheight}
\newsavebox{\xglyphbox}
\newlength{\xglyphheight}
\newcommand{\xbox}[1]%
   {\savebox{\ximagebox}{#1}%
    \settoheight{\ximageheight}{\usebox{\ximagebox}}%
    \savebox{\xglyphbox}{\char32}%
    \settoheight{\xglyphheight}{\usebox{\xglyphbox}}%
    \raisebox{\ximageheight}[0pt][0pt]{\raisebox{-\xglyphheight}[0pt][0pt]{%
      \makebox[0pt][l]{\usebox{\xglyphbox}}}}%
    \usebox{\ximagebox}%
    \raisebox{0pt}[0pt][0pt]{\makebox[0pt][r]{\usebox{\xglyphbox}}}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%         APACite - URL          %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\AtBeginDocument{%
  \urlstyle{APACsf}% APAC version of rm
  % \urlstyle{rm}%
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%   FOOTNOTES + ENUMERATE + ()   %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{footnote}
\usepackage{footnotebackref}
\let\svfootnoterule\footnoterule
\renewcommand\footnoterule{\vfill\svfootnoterule}

\usepackage{enumerate}
\usepackage{enumitem}

\let\originalleft\left
\let\originalright\right
\renewcommand{\left}{\mathopen{}\mathclose\bgroup\originalleft}
\renewcommand{\right}{\aftergroup\egroup\originalright}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%    COLOURS + PLOTS + MACROS    %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\input{diagramme.tex}		%plot styles
\input{cycolores.tex}		%colours + colour cycles
\input{macros.tex}		%macros
\input{hyph.tex}		%hyphenation


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%              TiKZ              %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{tikz}
\usetikzlibrary{calc,shadows,shapes,arrows,mindmap,trees,shapes.multipart,plotmarks}

\tikzset{
    invisible/.style={opacity=0},
    visible on/.style={alt={#1{}{invisible}}},
    alt/.code args={<#1>#2#3}{%
      \alt<#1>{\pgfkeysalso{#2}}{\pgfkeysalso{#3}} % \pgfkeysalso doesn't change the path
    },
  }


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%     LANDSCAPE + RAGGEDRIGHT    %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{rotating}

\usepackage{lscape}
\usepackage{pdflscape}

\usepackage{multicol}

\usepackage[document]{ragged2e}


%==========================================================%
%==========================================================%


\begin{document}
\frenchspacing
\urlstyle{foo}
\fontsize{11.5}{11.5}\selectfont
\addtocontents{toc}{~\hfill\textbf{Page}\par}
\input{chapseq.tex}

\end{document}
